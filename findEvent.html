<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/base.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript" src="http://www.parsecdn.com/js/parse-latest.js"></script>
  <style>
  .carousel-inner > .item > img,
  .carousel-inner > .item > a > img {
      width: 70%;
      margin: auto;
  }
  </style>

  <style>
  .box{
    width:300px;
    height:300px;
    position:absolute;
    z-index:10;
    background:rgba(68,68,67,.8);
  }
  </style>

  <header>
    <div class = "logoClass"> 
        <img src="images/logo.png" alt="EveMt" style='width:13%'>
    </div>
    
    <div id="nav" style="position:absolute !important; top:0">
       <ul>
          <li class="navbar"><a href="createAccount.html">Sign Out</a></li>
          <li ><a href="index.html">Home</a>
       </ul>
    </div>

 </header>
 <script>
    
  </script>

  <script>
    var arrayOfEventID = []; 
    var carouselCount = 0; 
    var maxCount; 
    function loadPictures() {
      Parse.initialize("ceajBSmAu77xOiu9Bki5uO11YFc7G6Xr0kqHTrvu", "EWFhdSHaW1Da1ua68a4NtN2NrVwi1GohZhjL22Ti");
      var event = Parse.Object.extend("event");
      var query = new Parse.Query(event);
      var myEvents = Parse.User.current().get("myEvents");  
      console.log(myEvents); 

      query.equalTo("private", false);
      query.find({
        success: function(results) {
        console.log("Successfully retrieved " + results.length + " public events.");
        var active; 
        maxCount = results.length-1; 
        for(var i = 0; i < results.length; i++) {

          if (i == 0)
              active = " active";
         else
             active = '';
          var object = results[i];

          var eventID; 
          eventID = object.id;

          var exists = false; 
          if(myEvents == null) {
            console.log("hi"); 
          } else {
            console.log(eventID);
            for(var j = 0; j < myEvents.length; j++) {
              if(myEvents[j] == eventID) {
                //exists = true;
              }
            } 
          }
          if(exists == true) {
            console.log("Skip loop"); 
            continue; 
          }
          console.log("Here");
          arrayOfEventID.push(eventID); 

          var eventPhoto = object.get('eventPhoto');
          var eventPhotoURL;
          if (eventPhoto == null) eventPhotoURL = "images/logo.png";
          else eventPhotoURL = eventPhoto.url();

          var eventTitle;
          if (object.get('Title') == null) eventTitle = "Event Title Unavailable";
          else eventTitle = object.get('Title');

          var eventDescription;
          if (object.get('description') == null) eventDescription = "Event Description Unavailable";
          else eventDescription = object.get('description');    

          var eventLocation;
          if (object.get('location') == null) eventLocation = "Event Location Unavailable;";
          else eventLocation = object.get('location') + " -";   

          var eventDateAndTime;
          if (object.get('dateAndTime') == null) eventDateAndTime = "Event Date and Time Unavailable";
          else eventDateAndTime = object.get('dateAndTime').toString().substring(0,21); 

          // Create the img html and set the src attribute to our URL
          var imgHtml =  "<img/src = " + eventPhotoURL + " style='width:1000px; filter:brightness(50%); height:450px';>" + "<div class='box'></div>"; 
          
          var captionHtml = "<div class= 'carousel-caption'> <h2 style='text-decoration:underline'> " + eventTitle + "</h2><br/> <br><h4>" 
            + eventDescription + "</h4><h4>" + eventLocation + " " 
            + eventDateAndTime + "</h4><button onclick = 'accepted(arrayOfEventID[carouselCount])' class='btn btn-default' id='going'> Going </button>" 
            + "<button  class='btn btn-default' id='notgoing'> Not Going </button><br/><br><br>";
          var totalHtml = imgHtml + captionHtml; 

          // Create the .item div and insert the img html into it
          var itemDivHtml = $("<div class='item" + active + "'/>").append(totalHtml);
          // Insert the .item div into the .carousel-inner div
          $(".carousel-inner").append(itemDivHtml);
        }
      }, error: function(error) {
            console.log("Error: " + error.code + " " + error.message);
        }
      });

    }

    function accepted(eventID) {
      console.log(arrayOfEventID);
      console.log(eventID); 
      var user = Parse.User.current(); 
      var myEvents = user.get("myEvents"); 
      user.addUnique("myEvents", eventID); 
      user.save(); 
      myEvents = user.get("myEvents"); 
      console.log(myEvents); 
      Parse.User.current().fetch();
    }

    function rejected(eventID) {
      

    }

    function increment() {
      if(carouselCount == maxCount) {
        carouselCount = 0;
      } else {
        carouselCount++; 
      }
    }
    function decrement() {
      if(carouselCount == 0) {
        carouselCount = maxCount; 
      } else {
        carouselCount--;
      }
    }

  </script>
</head>
<body onload = "loadPictures();" background = "background.png">

<div class="container">
  <br>
  <div id="myCarousel" class="carousel slide" >
    <!-- Indicators -->
   <!--  <ol class="carousel-indicators">
      <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
      <li data-target="#myCarousel" data-slide-to="1"></li>
      <li data-target="#myCarousel" data-slide-to="2"></li>
      <li data-target="#myCarousel" data-slide-to="3"></li>
    </ol> -->

    <!-- Wrapper for slides -->
    <div class="carousel-inner" role="listbox">
  
    </div>

    <!-- Left and right controls -->
    <a class="left carousel-control" onclick = "decrement();" 
      href="#myCarousel" role="button" data-slide="prev">
      <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="right carousel-control" onclick = "increment();" 
          href="#myCarousel" role="button" data-slide="next">
      <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>
</div>

</body>
</html>
