<!doctype html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>EveMt</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/calendar.css">
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript" src="http://www.parsecdn.com/js/parse-latest.js"></script>
  <link rel="stylesheet" href="css/eventStyle.css">
  <header>
      <div class = "logoClass"> 
          <img src="images/logo.png" alt="EveMt" style='width:13%; padding-bottom:50px;'>
      </div>
      
      <div id="nav" style="position:absolute !important; top:0">
         <ul>
            <li class="navbar"><a href="index.html" id="signout">Sign Out</a></li>
            <li ><a href="createEvent.html">Create Event</a>
            <li> <a href="landingPage.html">My Events</a>
            <li ><a href="findEvent.html">Home</a>
         </ul>
      </div>
  
   </header>
</head>

<body background="background.png">

  <div>
  	<table id="mainList">
  	</table>
  </div>

  <script type="text/javascript">
    Parse.initialize("ceajBSmAu77xOiu9Bki5uO11YFc7G6Xr0kqHTrvu", "EWFhdSHaW1Da1ua68a4NtN2NrVwi1GohZhjL22Ti");
    events = [];

  	window.onload = function() {
  	  loadLandingPage();
  	};

    $(document).on('click', '#going', function() {
      var id = $(this).closest('tr').attr('id');
      console.log(events[id]);
    });

    $(document).on('click', '#notgoing', function() {
      var id = $(this).closest('tr').attr('id');
      console.log(events[id]);
    });

    function signOut() {
      Parse.User.logOut();
    }

    var signOutEvent = document.getElementById("signout");
    signOutEvent.onclick = signOut;


  	function loadLandingPage() {
      var myevents = Parse.User.current().get("myEvents");
      var addElements = "";
      for (var i = 0; i < myevents.length; i++) {
        var event = Parse.Object.extend("event");
        var query = new Parse.Query(event);
        query.equalTo("objectId", myevents[i]);
        query.find({
          success: function(results) {
            var object = results[0];

            var eventPhoto = object.get('eventPhoto');
            var eventPhotoURL;
            if (eventPhoto == null) eventPhotoURL = "images/logo.png";
            else eventPhotoURL = eventPhoto.url();

            var eventTitle;
            if (object.get('Title') == null) eventTitle = "Event Title Unavailable";
            else eventTitle = object.get('Title');

            var eventDescription;
            if (object.get('description') == null) eventDescription = "Event Description Unavailable";
            else eventDescription = object.get('description');    

            var eventLocation;
            if (object.get('location') == null) eventLocation = "Event Location Unavailable;";
            else eventLocation = object.get('location') + ";";   

            var eventDateAndTime;
            if (object.get('dateAndTime') == null) eventDateAndTime = "Event Date and Time Unavailable";
            else eventDateAndTime = object.get('dateAndTime').toString().substring(0,21); 

            console.log(eventTitle);
            addElements += "<tr id=" + i.toString() + " >" 
                         + "<td> <img src=" + eventPhotoURL + " style='width:500px; height:209px;'> </td>" 
                              + "<td>" 
                              + "<li class='boxedentry' style='height:20px;width:380px'>" + eventTitle + "</li>"
                              + "<li class='boxedentry' style='height:80px;'>" + eventDescription + "</li>"
                              + "<li class='entry'>" + eventLocation + " "  + eventDateAndTime + "</li>"
                              + "<button id='notgoing'> Not Going </button>"
                            + "</td>"
                         + "</tr>"
            document.getElementById("mainList").innerHTML = addElements;

          },
          error: function(error) {
            console.log("Error: " + error.code + " " + error.message);
          }
        });
      }
      document.getElementById("mainList").innerHTML = addElements;

  	}
  </script>
</body>